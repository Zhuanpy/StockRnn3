# 基金持仓数据下载功能

## 📋 功能概述

根据 `download_minute_data.html` 的设计效果，重新实现了基金持仓数据下载功能，提供了现代化的用户界面和完整的数据管理功能。

## 🎯 主要特性

### 1. 现代化界面设计
- 参考 `download_minute_data.html` 的设计风格
- 响应式布局，支持移动设备
- 与系统整体风格保持一致
- 实时进度显示和状态更新

### 2. 数据保存功能
- **数据库保存**: 保存到 `fund_holdings_YYYYMMDD` 表
- **CSV文件保存**: 保存到 `data/funds_holdings/` 目录
- **文件命名**: `基金代码_YYYYMMDD.csv` 格式

### 3. 实时统计显示
- 总基金数
- 总记录数
- 已下载基金数
- 涉及股票数
- 下载日期

### 4. 下载控制
- 开始下载
- 暂停下载
- 实时进度显示
- 状态监控

## 📁 数据保存路径

### 建议的保存路径
```
项目根目录/
├── data/
│   └── funds_holdings/
│       ├── 000001_20241201.csv
│       ├── 000002_20241201.csv
│       └── ...
```

### 数据库表结构
```sql
CREATE TABLE fund_holdings_YYYYMMDD (
    id INT PRIMARY KEY AUTO_INCREMENT,
    fund_name VARCHAR(255) COMMENT '基金名称',
    fund_code VARCHAR(50) COMMENT '基金代码',
    stock_name VARCHAR(255) COMMENT '股票名称',
    stock_code VARCHAR(50) COMMENT '股票代码',
    holdings_ratio VARCHAR(20) COMMENT '持仓比例',
    market_value VARCHAR(50) COMMENT '市值',
    shares VARCHAR(50) COMMENT '持股数量',
    download_date DATE COMMENT '下载日期'
);
```

## 🚀 使用方法

### 1. 访问页面
```
http://localhost:5000/fund-holdings-page
```

### 2. API接口
- `GET /fund-holdings-page` - 基金持仓数据下载页面
- `POST /start-fund-holdings` - 开始下载
- `GET /fund-holdings-status` - 获取下载状态
- `POST /stop-fund-holdings` - 停止下载
- `GET /fund-holdings-statistics` - 获取统计数据

### 3. 配置基金代码
在 `App/routes/data/download_fund_route.py` 中修改 `FUND_CODES` 列表：

```python
FUND_CODES = [
    {'code': '000001', 'name': '华夏成长'},
    {'code': '000002', 'name': '华夏成长混合'},
    # 添加更多基金代码
]
```

## 🔧 技术实现

### 后端架构
- **路由**: `App/routes/data/download_fund_route.py`
- **数据模型**: `App/models/data/FundsAwkward.py`
- **下载逻辑**: 使用 `DownloadData.funds_awkward()` 方法
- **多线程**: 支持后台下载，不阻塞用户界面

### 前端实现
- **模板**: `App/templates/data/download_fund_data.html`
- **样式**: 使用CSS变量，与base.html保持一致
- **交互**: JavaScript实时更新状态和进度
- **响应式**: 支持不同屏幕尺寸

### 数据流程
1. 用户点击"开始下载"
2. 后端启动下载线程
3. 逐个下载基金持仓数据
4. 同时保存到数据库和CSV文件
5. 实时更新进度和状态
6. 下载完成后显示统计信息

## 📊 数据格式

### CSV文件格式
```csv
fund_name,fund_code,stock_name,stock_code,holdings_ratio,market_value,shares,download_date
华夏成长,000001,贵州茅台,600519,5.23%,1234567890,1000000,2024-12-01
华夏成长,000001,腾讯控股,00700,4.56%,987654321,500000,2024-12-01
```

### 数据库记录
- 按日期分表存储
- 支持按基金代码或股票代码查询
- 自动创建表结构

## 🧪 测试

运行测试脚本验证功能：
```bash
python test_fund_download.py
```

## 🔄 与原有功能的对比

### 改进点
1. **界面设计**: 现代化卡片式设计，更好的用户体验
2. **数据保存**: 同时保存到数据库和CSV文件
3. **实时统计**: 显示详细的下载统计信息
4. **错误处理**: 更好的异常处理和日志记录
5. **响应式**: 支持移动设备访问

### 保持兼容
- 使用相同的下载数据源
- 保持数据库表结构兼容
- 支持原有的API调用方式

## 📝 注意事项

1. **基金代码配置**: 需要在代码中配置要下载的基金代码列表
2. **数据目录**: 确保 `data/funds_holdings/` 目录存在
3. **数据库连接**: 确保数据库连接正常
4. **网络访问**: 需要能够访问东方财富数据源
5. **下载频率**: 建议控制下载频率，避免被限制访问

## 🎉 总结

新的基金下载功能提供了：
- ✅ 现代化的用户界面
- ✅ 完整的数据保存功能（数据库+CSV）
- ✅ 实时进度和状态显示
- ✅ 详细的统计信息
- ✅ 响应式设计
- ✅ 与系统风格一致

数据保存路径建议：`data/funds_holdings/`，文件格式为CSV，便于后续数据分析和处理。 